<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Pendaftaran Anggota Sinergi Ekonomi Krapyak</title>
    <link rel="icon" href="assets/logo_sinergi_krapyak.jpg" type="image/jpeg">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
    <style>
        .mobile-search-trigger {
            display: none !important;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="header-wrapper">
            <a href="index.html" class="logo-link">
                <img src="assets/logo_sinergi_krapyak.jpg" alt="Logo Sinergi Krapyak" class="logo">
            </a>
            <div class="header-right">
                <nav class="main-nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="form.html" class="nav-link active">Isi Form</a>
                    <a href="statistik.html" class="nav-link">Statistik</a>
                    <a href="tentang.html" class="nav-link">Tentang</a>
                </nav>
                <div class="header-actions">
                    <button class="mobile-search-trigger" id="mobile-search-trigger" style="display: none !important;"></button>
                    <div class="mobile-menu-trigger" id="burger-menu-trigger">
                        <img src="assets/menu_kebab.svg" alt="Menu">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="menu-overlay" id="menu-overlay"></div>
    <nav class="main-nav" id="main-nav">
        <button class="nav-close-btn" id="nav-close-btn">&times;</button>
        <a href="index.html" class="nav-link">Home</a>
        <a href="form.html" class="nav-link active">Isi Form</a>
        <a href="statistik.html" class="nav-link">Statistik</a>
        <a href="tentang.html" class="nav-link">Tentang</a>
    </nav>

    <main class="container">
        <form id="data-form" class="form-container">
            <div class="form-header">
                <h1>Form Anggota</h1>
                <p>Ceritakan tentang Anda, ini akan membantu kita untuk saling bersinergi.</p>
            </div>

            <!-- Informasi Calon Anggota (Gabungan) -->
            <fieldset class="form-section">
                <legend class="form-section-title">Biodata Diri</legend>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nama_lengkap">Nama Lengkap <span class="mandatory-star">*</span></label>
                        <div class="input-wrapper">
                            <input type="text" id="nama_lengkap" name="nama_lengkap" required maxlength="80">
                            <span class="clear-icon">&times;</span>
                        </div>
                        <div class="char-counter">0 / 80</div>
                    </div>
                    <div class="form-group">
                        <label for="nama_panggilan">Nama Panggilan</label>
                        <div class="input-wrapper">
                            <input type="text" id="nama_panggilan" name="nama_panggilan" maxlength="30">
                            <span class="clear-icon">&times;</span>
                        </div>
                        <div class="char-counter">0 / 30</div>
                    </div>
                     <div class="form-group">
                        <label for="alumni">Alumni</label>
                        <input type="text" id="alumni" name="alumni" value="Pondok Pesantren Krapyak Yogyakarta" readonly style="background-color: #e9ecef;">
                    </div>
                    <div class="form-group">
                        <label for="th_masuk">Tahun Masuk <span class="mandatory-star">*</span></label>
                        <select id="th_masuk" name="th_masuk" required>
                            <option value="" disabled selected>Pilih Tahun</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="th_keluar">Tahun Keluar</label>
                        <select id="th_keluar" name="th_keluar">
                            <option value="" disabled selected>Pilih Tahun</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="komplek">Komplek <span class="mandatory-star">*</span></label>
                        <div class="input-wrapper">
                            <input type="text" id="komplek" name="komplek" required maxlength="30">
                             <span class="clear-icon">&times;</span>
                        </div>
                         <div class="char-counter">0 / 30</div>
                    </div>
                    <div class="form-group">
                        <label for="domisili">Domisili (Kota/Kabupaten) <span class="mandatory-star">*</span></label>
                        <select id="domisili" name="domisili" required>
                            <option value="" disabled selected>Memuat data...</option>
                        </select>
                    </div>
                    <div class="form-group form-group-full">
                        <label for="detail_alamat">Detail Alamat</label>
                        <div class="input-wrapper">
                            <textarea id="detail_alamat" name="detail_alamat" rows="3" placeholder="Contoh: Jl. KH Ahmad Dahlan No. 21, RT 04 RW 02..." maxlength="300"></textarea>
                            <span class="clear-icon">&times;</span>
                        </div>
                        <div class="char-counter">0 / 300</div>
                        <div class="field-privacy-switch">
                            <label class="switch">
                                <input type="checkbox" id="alamat_active" name="alamat_active" checked>
                                <span class="slider"></span>
                            </label>
                            <label for="alamat_active" class="switch-label">Tampilkan Alamat di Publik?</label>
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="no_hp_anggota">No. HP (WhatsApp) <span class="mandatory-star">*</span></label>
                        <div class="phone-input-wrapper">
                            <span class="phone-prefix">+62</span>
                            <input type="tel" id="no_hp_anggota" name="no_hp_anggota" placeholder="81234567890" required pattern="[0-9]{9,13}">
                        </div>
                        <div class="field-privacy-switch">
                            <label class="switch">
                                <input type="checkbox" id="no_hp_active" name="no_hp_active" checked>
                                <span class="slider"></span>
                            </label>
                            <label for="no_hp_active" class="switch-label">Tampilkan No. HP di Publik?</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="profesi">Profesi Utama</label>
                         <select id="profesi" name="profesi">
                            <option value="" disabled selected>Memuat data...</option>
                        </select>
                    </div>
                     <div class="form-group form-group-full">
                        <label for="detail_profesi">Deskripsi Detail Profesi</label>
                        <div class="input-wrapper">
                            <textarea id="detail_profesi" name="detail_profesi" rows="3" placeholder="Contoh: Menjalankan usaha kuliner di Bandung, fokus pada makanan khas Jawa Tengah sejak 2018" maxlength="500"></textarea>
                            <span class="clear-icon">&times;</span>
                        </div>
                        <div class="char-counter">0 / 500</div>
                    </div>
                 <div class="form-group ai-group">
                    <label for="pengembangan_profesi">Rencana pengembangan profesi/keahlian</label>
                    <div class="input-wrapper">
                        <textarea id="pengembangan_profesi" name="pengembangan_profesi" rows="4" placeholder="Contoh: Ingin memperluas layanan ke bidang edukasi kesehatan masyarakat" maxlength="500"></textarea>
                        <span class="clear-icon">&times;</span>
                    </div>
                    <div class="char-counter">0 / 500</div>
                    <button type="button" class="ai-btn" data-target="pengembangan_profesi" aria-label="Generate dengan AI" disabled>✨</button>
                </div>
                <div class="form-group ai-group">
                    <label for="ide">Ide/gagasan untuk Sinergi Ekonomi Santri</label>
                    <div class="input-wrapper">
                        <textarea id="ide" name="ide" rows="4" placeholder="Tulis ide atau kontribusi Anda untuk pengembangan ekonomi santri..." maxlength="500"></textarea>
                        <span class="clear-icon">&times;</span>
                    </div>
                    <div class="char-counter">0 / 500</div>
                    <button type="button" class="ai-btn" data-target="ide" aria-label="Generate dengan AI" disabled>✨</button>
                </div>
                 <div class="form-group ai-group">
                    <label for="lain_lain">Lain-lain</label>
                     <div class="input-wrapper">
                        <textarea id="lain_lain" name="lain_lain" rows="3" placeholder="Informasi tambahan yang relevan..." maxlength="500"></textarea>
                        <span class="clear-icon">&times;</span>
                    </div>
                    <div class="char-counter">0 / 500</div>
                    <button type="button" class="ai-btn" data-target="lain_lain" aria-label="Generate dengan AI" disabled>✨</button>
                </div>
                </div>
            </fieldset>

            <!-- Bagian Usaha (Dinamis) -->
            <fieldset class="form-section">
                <legend class="form-section-title">Informasi Usaha (Opsional)</legend>
                <div id="business-list-container">
                    <!-- Blok usaha akan ditambahkan di sini oleh JS -->
                </div>
                <button type="button" id="add-business-btn" class="add-btn"><i class="fas fa-plus-circle"></i> Tambah Usaha</button>
            </fieldset>

            <div class="form-actions">
                <button type="reset" class="btn btn-secondary">Reset</button>
                <button type="submit" class="btn btn-primary">Kirim Data</button>
            </div>
        </form>
    </main>

    <!-- TEMPLATE UNTUK BLOK USAHA -->
    <template id="business-entry-template">
        <div class="business-entry-card">
            <button type="button" class="remove-btn remove-business-btn" aria-label="Hapus Usaha">&times;</button>
            <div class="form-grid">
                <div class="form-group">
                    <label>Nama Usaha</label>
                    <div class="input-wrapper">
                        <input type="text" name="nama_usaha" required maxlength="100">
                        <span class="clear-icon">&times;</span>
                    </div>
                    <div class="char-counter">0 / 100</div>
                </div>
                <div class="form-group">
                    <label>Kategori Usaha</label>
                    <select name="kategori_usaha">
                        <option value="" selected>Pilih Kategori...</option>
                    </select>
                    <div class="category-description"></div>
                </div>
                <div class="form-group">
                    <label>Jenis Usaha</label>
                     <div class="input-wrapper">
                        <input type="text" name="jenis_usaha" maxlength="50" placeholder="Contoh: Warung Makan, Jasa Desain">
                        <span class="clear-icon">&times;</span>
                    </div>
                    <div class="char-counter">0 / 50</div>
                </div>
                 <div class="form-group">
                    <label>Nomor HP Usaha (WhatsApp)</label>
                    <div class="phone-input-wrapper">
                        <span class="phone-prefix">+62</span>
                        <input type="tel" name="no_hp_perusahaan" placeholder="81234567890" pattern="[0-9]{9,13}">
                    </div>
                </div>
                 <div class="form-group form-group-full ai-group">
                    <label>Detail/Deskripsi Usaha</label>
                    <div class="input-wrapper">
                        <textarea name="detail_usaha" rows="3" maxlength="500"></textarea>
                         <span class="clear-icon">&times;</span>
                    </div>
                    <div class="char-counter">0 / 500</div>
                    <button type="button" class="ai-btn" data-target="detail_usaha" aria-label="Generate dengan AI" disabled>✨</button>
                </div>
                 <div class="form-group form-group-full ai-group">
                    <label>Prospek Kerjasama/Penawaran</label>
                    <div class="input-wrapper">
                        <textarea name="prospek_kerjasama_penawaran" rows="3" maxlength="500" placeholder="Contoh: Terbuka untuk kerjasama reseller, mencari pemasok bahan baku, atau menawarkan jasa konsultasi..."></textarea>
                        <span class="clear-icon">&times;</span>
                    </div>
                     <div class="char-counter">0 / 500</div>
                    <button type="button" class="ai-btn" data-target="prospek_kerjasama_penawaran" aria-label="Generate dengan AI" disabled>✨</button>
                </div>

                <div class="form-group form-group-full">
                    <label>URL Website</label>
                    <div class="url-input-wrapper">
                        <span class="url-prefix">https://www.</span>
                        <input type="text" name="website_perusahaan" placeholder="namadomain.com">
                    </div>
                </div>
                <div class="form-group form-group-full">
                    <label>URL Google Maps</label>
                    <div class="url-input-wrapper">
                        <span class="url-prefix">https://maps.app.goo.gl/</span>
                        <input type="text" name="url_gmaps_perusahaan" placeholder="abcDeFgHiJkLmN">
                    </div>
                </div>
            </div>
            
            <!-- Sub-section untuk Toko Online -->
            <div class="sub-section">
                <h4 class="sub-section-title">Toko Online (Marketplace)</h4>
                <div class="shop-list-container">
                    <!-- Isian toko online akan ditambahkan di sini -->
                </div>
                <button type="button" class="add-btn add-shop-btn"><i class="fas fa-plus"></i> Tambah Toko</button>
            </div>

            <!-- Sub-section untuk Media Sosial -->
            <div class="sub-section">
                <h4 class="sub-section-title">Media Sosial</h4>
                <div class="social-list-container">
                    <!-- Isian media sosial akan ditambahkan di sini -->
                </div>
                <button type="button" class="add-btn add-social-btn"><i class="fas fa-plus"></i> Tambah Sosmed</button>
            </div>
        </div>
    </template>

    <!-- TEMPLATE UNTUK ISIAN TOKO ONLINE/SOSMED -->
    <template id="link-entry-template">
        <div class="link-entry">
            <div class="form-group platform-selector">
                <label>Platform</label>
                <select name="platform">
                    <option value="">Pilih Platform</option>
                    <optgroup label="Toko Online">
                        <option value="Shopee">Shopee</option>
                        <option value="Tokopedia">Tokopedia</option>
                        <option value="Lazada">Lazada</option>
                        <option value="TikTok Shop">TikTok Shop</option>
                        <option value="Blibli">Blibli</option>
                    </optgroup>
                    <optgroup label="Media Sosial">
                        <option value="Instagram">Instagram</option>
                        <option value="Facebook">Facebook</option>
                        <option value="TikTok">TikTok</option>
                        <option value="YouTube">YouTube</option>
                    </optgroup>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>
            <div class="form-group url-input">
                <label>URL</label>
                 <div class="url-input-wrapper">
                    <span class="url-prefix">https://</span>
                    <input type="text" name="url" placeholder="..." required>
                </div>
                <!-- This input is for "Lainnya", hidden by default -->
                <input type="url" name="plain_url" class="plain-url-input" placeholder="https://..." style="display:none;">
            </div>
            <button type="button" class="remove-btn remove-link-btn" aria-label="Hapus">&times;</button>
        </div>
    </template>
    
    <!-- Modal Konfirmasi -->
    <div id="confirmation-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div id="review-section">
                <h2>Periksa Kembali Data Anda</h2>
                <p>Pastikan semua informasi yang Anda masukkan sudah benar sebelum melanjutkan.</p>
                <div id="modal-preview-grid" class="modal-preview-grid">
                    <!-- Data preview akan disisipkan di sini oleh JS -->
                </div>
                <div class="modal-button-group">
                    <button type="button" id="modal-edit-btn" class="btn btn-secondary">Edit Kembali</button>
                    <button type="button" id="modal-continue-btn" class="btn btn-primary">Lanjut ke Verifikasi</button>
                </div>
            </div>

            <div id="captcha-section" style="display:none;">
                <h2>Verifikasi Anti-Spam</h2>
                <p>Untuk memastikan Anda bukan robot, harap jawab pertanyaan sederhana di bawah ini.</p>
                <div class="captcha-challenge">
                    <span id="captcha-question"></span>
                    <input type="number" id="captcha-answer" placeholder="Jawaban Anda...">
                </div>
                 <div class="modal-button-group">
                    <button type="button" id="modal-back-btn" class="btn btn-secondary">Kembali</button>
                    <button type="button" id="modal-submit-btn" class="btn btn-primary">Kirim Data Sekarang</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Status Pengiriman -->
    <div id="status-modal" class="modal-overlay" style="display:none;">
         <div class="modal-content">
             <div id="submission-loading">
                <div class="spinner"></div>
                <p>Mengirim data...</p>
             </div>
             <div id="submission-success" style="display:none;">
                <i class="fas fa-check-circle success-icon"></i>
                <h2>Terima Kasih!</h2>
                <p>Data Anda telah berhasil dikirim.</p>
                <a href="index.html" class="btn btn-primary">Kembali ke Direktori</a>
             </div>
             <div id="submission-error" style="display:none;">
                <i class="fas fa-times-circle error-icon"></i>
                <h2>Gagal Mengirim</h2>
                <p>Terjadi kesalahan. Silakan coba lagi nanti.</p>
                <button type="button" id="error-close-btn" class="btn btn-secondary">Tutup</button>
             </div>
         </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="form.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('confirmation-modal');
            const reviewSection = document.getElementById('review-section');
            const captchaSection = document.getElementById('captcha-section');
            let captchaAnswer = 0;

            function showCaptcha() {
                reviewSection.style.display = 'none';
                captchaSection.style.display = 'block';
                const num1 = Math.floor(Math.random() * 10) + 1;
                const num2 = Math.floor(Math.random() * 10) + 1;
                captchaAnswer = num1 + num2;
                document.getElementById('captcha-question').textContent = `Berapa ${num1} + ${num2} ?`;
                document.getElementById('captcha-answer').value = '';
            }

            function showReview() {
                captchaSection.style.display = 'none';
                reviewSection.style.display = 'block';
            }
            
            // Event Listeners untuk Tombol Modal
            document.getElementById('modal-edit-btn').addEventListener('click', () => modal.style.display = 'none');
            document.getElementById('modal-continue-btn').addEventListener('click', showCaptcha);
            document.getElementById('modal-back-btn').addEventListener('click', showReview);
            document.getElementById('modal-submit-btn').addEventListener('click', () => {
                const userAnswer = parseInt(document.getElementById('captcha-answer').value, 10);
                if (userAnswer === captchaAnswer) {
                    // Verifikasi berhasil, mulai proses pengiriman
                    modal.style.display = 'none';
                    const statusModal = document.getElementById('status-modal');
                    statusModal.style.display = 'flex';
                    document.getElementById('submission-loading').style.display = 'block';
                    document.getElementById('submission-success').style.display = 'none';
                    document.getElementById('submission-error').style.display = 'none';

                    // Ambil data final dan URL Apps Script
                    const dataToSubmit = window.finalData;
                    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzfiL-WCksPK4Lon4NZGhe4K4IKhJO8Pt3_4phZ7qsgm76ATfoXRiV-2bt4c9ZAFK-a/exec";

                     // Kirim data ke Google Apps Script
                    fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        cache: 'no-cache',
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                        body: JSON.stringify(dataToSubmit)
                    })
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === "success") {
                            document.getElementById('submission-loading').style.display = 'none';
                            document.getElementById('submission-success').style.display = 'block';
                            // Redirect ke halaman detail setelah 2 detik menggunakan ID dari server
                            setTimeout(() => {
                                window.location.href = `detail.html?id=${data.id_anggota}`;
                            }, 2000);
                        } else {
                            throw new Error(data.message || 'Terjadi kesalahan dari server.');
                        }
                    })
                    .catch(error => {
                        console.error('Error submitting data:', error);
                        document.getElementById('submission-loading').style.display = 'none';
                        document.getElementById('submission-error').style.display = 'block';
                    });

                } else {
                    alert('Jawaban verifikasi salah. Silakan coba lagi.');
                }
            });

            // Tambahkan listener untuk tombol tutup pada modal error
            document.getElementById('error-close-btn').addEventListener('click', () => {
                document.getElementById('status-modal').style.display = 'none';
            });
        });
    </script>
    <script src="main.js"></script>
</body>
</html> 
